!function(a,b){"use strict";function c(){g.empty()}function d(a,b,c){g.html(f({type:"alert-error",heading:b,message:c,close:!1}))}var e='<div class="alert alert-block <%= type %>"><% if (close) { %><a class="close" data-dismiss="alert" href="#">Ã—</a><% } %><h4 class="alert-heading"><%= heading %></h4><%= message %></div>',f=b.template(e),g=a("#message");a.subscribe("clear.message.conpa",c),a.subscribe("error.message.conpa",d)}(jQuery,_),function(a){"use strict";function b(b,c){a.ajax({url:"/ConPA/getLastCreatedPortfolios",data:{limit:b},success:function(b){_.extend(b,{limit:c-1},a.conpa.helpers),p.html(n(b)),a.publish("render.latestptfschart.conpa",[b])}})}function c(b){a.ajax({url:b.url,success:function(c){b.node.html(o({keyName:b.keyName,idDesc:b.idDesc,rows:c.rows,helpers:a.conpa.helpers}))}})}function d(){c({node:q,url:"/ConPA/getBestPerformingPortfolios",keyName:"Perf",idDesc:"Best"})}function e(){c({node:r,url:"/ConPA/getWorstPerformingPortfolios",keyName:"Perf",idDesc:"Worst"})}function f(){c({node:s,url:"/ConPA/getLowProfileRiskPortfolios",keyName:"Risk",idDesc:"Low"})}function g(){c({node:t,url:"/ConPA/getHighProfileRiskPortfolios",keyName:"Risk",idDesc:"High"})}function h(){c({node:u,url:"/ConPA/getLowProfileReturnPortfolios",keyName:"Ret",idDesc:"Low"})}function i(){c({node:v,url:"/ConPA/getHighProfileReturnPortfolios",keyName:"Ret",idDesc:"High"})}function j(b){var c=a(b.target).parent().data("id");return c?(a("html, body").animate({scrollTop:0},"slow"),a.ajax({url:"/ConPA/getPortfolio",type:"POST",data:{id:c},success:function(b){var c,d={};b.error||(d.assets=[],_.each(b.assets,function(b){d.assets.push({id:a.conpa.utils.rfc4122v4(),symbol:b})}),c=new Date(b.ref),d.refdate=a.conpa.dates.isToday(c)?a.conpa.dates.yearToDate().toString():new Date(b.ref).toString(),a.sync("conpa",d),a.publish("render.app.conpa"))}}),void 0):!1}function k(){b(100,12),d(),e(),f(),g(),h(),i()}var l='<table class="table table-bordered table-condensed table-hover"><thead><tr><th>To Date</th><th>Reference Date</th><th>Last Created</th><th>Perf</th><th>Risk</th><th>Ret</th></tr></thead><tbody><% _.each(rows, function (row, key, list) { %><% if (key > limit) { %><% return; %><% } %><tr data-id=<%= row.id %>><td><%= row.key %></td><td><%= row.value.ref %></td><td title=<%= row.id %>><%= hyphenFormatter(row.id) %></td><td><%= percentageFormatter(row.value.perf) %></td><td><%= percentageFormatter(row.value.risk) %></td><td><%= percentageFormatter(row.value.ret) %></td></tr><% }) %></tbody></table>',m='<table class="table table-bordered table-condensed table-hover"><thead><tr><th><%= keyName %></th><th>To Date</th><th><%= idDesc %></th></tr></thead><tbody><% _.each(rows, function (row, key, list) { %><tr data-id=<%= row.id %>><td><%= helpers.percentageFormatter(row.key) %></td><td><%= row.value.created_at %></td><td title=<%= row.id %>><%= helpers.hyphenFormatter(row.id) %></td></tr><% }) %></tbody></table>',n=_.template(l),o=_.template(m),p=a("#latest-portfolios-list"),q=a("#best-performing-portfolios-list"),r=a("#worst-performing-portfolios-list"),s=a("#lowprofile-risk-portfolios-list"),t=a("#highprofile-risk-portfolios-list"),u=a("#lowprofile-return-portfolios-list"),v=a("#highprofile-return-portfolios-list");a("body").on("click",".table tbody tr",j),a.subscribe("render.dashboard.conpa",k)}(jQuery),function(a){"use strict";function b(b,c,d,e,f,g,h,i,j){a.ajax({url:"/ConPA/putPortfolioOnCRM",type:"POST",data:{symbols:c,weights:d,ref:e,ret:f,risk:g,perf:h,highs:i,lows:j},success:function(){a.publish("render.dashboard.conpa")}})}a.subscribe("crm.portfolio.conpa",b)}(jQuery),function(a){"use strict";function b(b,c,d){b.sparkline(d,{type:"pie",height:"150",offset:90,tooltipFormatter:function(b,e,f){var g;return a.grep(d,function(a,b){a===f.value&&(g=b)}),c[g]+" "+a.conpa.helpers.percentageFormatter(f.value)}})}function c(b,c){b.sparkline(c,{type:"bar",height:"150",barWidth:2,tooltipFormatter:function(b,c,d){return a.conpa.helpers.percentageFormatter(d[0].value)}})}function d(d,e){var f=[],l=[];d=a.map(d,function(a,b){return f[b]=0,l[b]=-1,a.symbol}),d.length<3||(e=e||(new Date).toString(),a.ajax({url:"/ConPA/getOptimalPortfolio",type:"POST",data:{prods:d,referenceDate:e,targetReturn:void 0,lows:f,highs:l},success:function(m){return m.message?(a.publish("error.message.conpa",["Optimization error",m.message]),void 0):(a.publish("crm.portfolio.conpa",[d,m.optim.solution,e,m.optim.pm,m.optim.ps,m.perf,l,f]),m.perf.length?(h.html(a.conpa.dates.ymdDate(e)+" Weights"),b(i,d,m.optim.solution),j.html(a.conpa.dates.ymdDate(e)+" Performance"),c(k,m.perf)):b(g,d,m.optim.solution),void 0)}}))}function e(){g.empty(),i.empty(),k.empty()}function f(a,b,c){d(b,c)}var g=a("#basket-pie-chart"),h=a("#basket-pie-refdate-label"),i=a("#basket-pie-ytd-chart"),j=a("#basket-performance-refdate-label"),k=a("#basket-performance-ytd-chart");a.subscribe("clear.portfolio.conpa",e),a.subscribe("optimize.portfolio.conpa",f)}(jQuery),function(a,b){"use strict";b.load("visualization","1",{packages:["corechart"],callback:function(){function c(a){return 1*(100*a).toFixed(2)}function d(d,e){var f={backgroundColor:"#eee",title:"Graph based on the latest 100 portfolios",hAxis:{title:"Risk %"},vAxis:{title:"Return %"},legend:"none"},g=[],h=new google.visualization.DataTable,i=new b.visualization.ScatterChart(a("#efficient-frontier").get()[0]);h.addColumn("number","Risk"),h.addColumn("number","Return"),h.addColumn({type:"string",role:"tooltip"}),e.rows.forEach(function(a){var b=c(parseFloat(a.value.risk)),d=c(parseFloat(a.value.ret)),e=c(parseFloat(a.value.perf));g.push([b,d,"Risk: "+b+"%\n"+"Return: "+d+"%\n"+"Performance: "+e+"%\n"])}),h.addRows(g),i.draw(h,f)}a.subscribe("render.latestptfschart.conpa",d)}})}(jQuery,google),function(a,b){"use strict";function c(b){a.ajax({url:"/ConPA/getKeyStatistics",type:"POST",data:{symbol:b},success:function(a){var c,d,e;a.length&&(c=a.length/2,d=a,e=d.splice(0,c),g.html("Asset Stats for "+b),h.html(f({fields:e})),i.html(f({fields:d})))}})}function d(a,b){c(b)}var e='<dl class="dl-horizontal"><% _.each(fields, function (field) { %><dt title="<%= field.label %>"><%= field.label %></dt><dd><%= field.value %></dd><% }) %></dl>',f=b.template(e),g=a("#asset-stats-name"),h=a("#asset-stats-list1"),i=a("#asset-stats-list2");a.subscribe("stats.asset.conpa",d)}(jQuery,_),function(a){"use strict";function b(){f.html(e({assets:a.sync("conpa").assets}))}function c(c){var d=a(c.target).closest("li").data("id"),e=a.sync("conpa");a.each(e.assets,function(c,f){return f.id===d?(e.assets.splice(c,1),e.assets.length<3&&(e.refdate=a.conpa.dates.yearToDate().toString()),a.sync("conpa",e),b(),a.publish("render.app.conpa"),!1):void 0})}var d='<% _.each(assets, function (asset, key, list) { %><li data-id="<%= asset.id %>"><div class="well"><div><%= asset.symbol %></div><div class="destroy"></div></div></li><% }) %>',e=_.template(d),f=a("#asset-list");f.on("click",".destroy",c),a.subscribe("render.assetlist.conpa",b)}(jQuery);var YAHOO={};YAHOO.Finance={},YAHOO.Finance.SymbolSuggest={},function(a){"use strict";var b={};a("input").typeahead({items:10,source:function(a,c){jQuery.ajax({type:"GET",dataType:"jsonp",jsonp:"callback",jsonpCallback:"YAHOO.Finance.SymbolSuggest.ssCallback",data:{query:a},cache:!0,url:"http://autoc.finance.yahoo.com/autoc"}),YAHOO.Finance.SymbolSuggest.ssCallback=function(a){var d;d=jQuery.map(a.ResultSet.Result,function(a){var c={symbol:a.symbol,name:a.name,type:a.type,exchDisp:a.exchDisp},d=c.symbol+" "+c.name+" ("+c.type+" - "+c.exchDisp+")";return b[d]=c,d}),c(d)}},updater:function(a){return b[a].symbol}})}(jQuery),function(a){"use strict";a.conpa={utils:{rfc4122v4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"===a?b:8|3&b;return c.toString(16)})}},helpers:{percentageFormatter:function(a){return(100*a).toFixed(2)+"%"},hyphenFormatter:function(a){return a.substr(0,5)+"..."+a.substr(a.length-5,5)}},dates:{today:function(){return new Date},isToday:function(b){var c=a.conpa.dates.today(),d=c.getDate(),e=c.getMonth(),f=c.getFullYear(),g=b.getDate(),h=b.getMonth(),i=b.getFullYear();return d===g&&e===h&&f===i},yearToDate:function(){return new Date(a.conpa.dates.today()-31536e6)},ymdDate:function(a){var b=new Date(a),c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear();return e+"/"+(10>d?"0"+d:d)+"/"+(10>c?"0"+c:c)}}}}(jQuery),function(a){"use strict";var b={init:function(){var b=a.sync("conpa");b.assets=b.assets||[],b.refdate=b.refdate||a.conpa.dates.yearToDate().toString(),a.sync("conpa",{assets:b.assets,refdate:b.refdate}),a("#new-asset").on("change",this.create),a.publish("render.dashboard.conpa"),a.publish("render.app.conpa")},create:function(b){var c=a.sync("conpa"),d=a(b.target),e=a.trim(d.val());d.val(""),b.hasOwnProperty("originalEvent")||(c.assets.push({id:a.conpa.utils.rfc4122v4(),symbol:e}),a.sync("conpa",c),a.publish("render.app.conpa"))},render:function(){var b=a.sync("conpa"),c=_.last(b.assets);a.publish("clear.portfolio.conpa"),a.publish("clear.message.conpa"),a.publish("render.assetlist.conpa"),b.assets.length&&a.publish("stats.asset.conpa",[c.symbol]),a.publish("optimize.portfolio.conpa",[b.assets,a.conpa.dates.today().toString()]),a.publish("optimize.portfolio.conpa",[b.assets,b.refdate])}};a.subscribe("render.app.conpa",b.render),b.init()}(jQuery);