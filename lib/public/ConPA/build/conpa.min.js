(function(a){function e(){d.empty()}function f(a,b,e){d.html(c({type:"alert-error",heading:b,message:e}))}"use strict";var b='<div class="alert alert-block <%= type %>"><a class="close" data-dismiss="alert" href="#">Ã—</a><h4 class="alert-heading"><%= heading %></h4><%= message %></div>',c=_.template(b),d=a("#message");a.subscribe("clear.message.conpa",e),a.subscribe("error.message.conpa",f)})(jQuery),function(a){function m(){a.ajax({url:"/ConPA/getLastCreatedPortfolios",success:function(b){_.extend(b,a.conpa.helpers),f.html(d(b))}})}function n(b){a.ajax({url:b.url,success:function(c){b.node.html(e({keyName:b.keyName,idDesc:b.idDesc,rows:c.rows,helpers:a.conpa.helpers}))}})}function o(){n({node:g,url:"/ConPA/getBestPerformingPortfolios",keyName:"Perf",idDesc:"Best"})}function p(){n({node:h,url:"/ConPA/getWorstPerformingPortfolios",keyName:"Perf",idDesc:"Worst"})}function q(){n({node:i,url:"/ConPA/getLowProfileRiskPortfolios",keyName:"Risk",idDesc:"Low"})}function r(){n({node:j,url:"/ConPA/getHighProfileRiskPortfolios",keyName:"Risk",idDesc:"High"})}function s(){n({node:k,url:"/ConPA/getLowProfileReturnPortfolios",keyName:"Ret",idDesc:"Low"})}function t(){n({node:l,url:"/ConPA/getHighProfileReturnPortfolios",keyName:"Ret",idDesc:"High"})}function u(){m(),o(),p(),q(),r(),s(),t()}"use strict";var b='<table class="table table-bordered table-condensed"><thead><tr><th>To Date</th><th>Reference Date</th><th>Last Created</th><th>Perf</th><th>Risk</th><th>Ret</th></tr></thead><tbody><% _.each(rows, function (row, key, list) { %><tr><td><%= row.key %></td><td><%= row.value.ref %></td><td><%= hyphenFormatter(row.id) %></td><td><%= percentageFormatter(row.value.perf) %></td><td><%= percentageFormatter(row.value.risk) %></td><td><%= percentageFormatter(row.value.ret) %></td></tr><% }) %></tbody></table>',c='<table class="table table-bordered table-condensed"><thead><tr><th><%= keyName %></th><th>To Date</th><th><%= idDesc %></th></tr></thead><tbody><% _.each(rows, function (row, key, list) { %><tr><td><%= helpers.percentageFormatter(row.key) %></td><td><%= row.value.created_at %></td><td><%= helpers.hyphenFormatter(row.id) %></td></tr><% }) %></tbody></table>',d=_.template(b),e=_.template(c),f=a("#latest-portfolios-list"),g=a("#best-performing-portfolios-list"),h=a("#worst-performing-portfolios-list"),i=a("#lowprofile-risk-portfolios-list"),j=a("#highprofile-risk-portfolios-list"),k=a("#lowprofile-return-portfolios-list"),l=a("#highprofile-return-portfolios-list");a.subscribe("render.dashboard.conpa",u)}(jQuery),function(a){function b(b,c,d,e,f,g,h,i,j){a.ajax({url:"/ConPA/putPortfolioOnCRM",type:"POST",data:{symbols:c,weights:d,ref:e,ret:f,risk:g,perf:h,highs:i,lows:j},success:function(){a.publish("render.dashboard.conpa")}})}"use strict",a.subscribe("crm.portfolio.conpa",b)}(jQuery),function(a){function e(b,c,d){b.sparkline(d,{type:"pie",height:"150",offset:90,tooltipFormatter:function(b,e,f){var g;return a.grep(d,function(a,b){a===f.value&&(g=b)}),c[g]+" "+a.conpa.helpers.percentageFormatter(f.value)}})}function f(b,c){b.sparkline(c,{type:"bar",height:"150",barWidth:2,tooltipFormatter:function(b,c,d){return a.conpa.helpers.percentageFormatter(d[0].value)}})}function g(g,h){var i=[],j=[];g=a.map(g,function(a,b){return i[b]=0,j[b]=-1,a.symbol});if(g.length<3)return;h=h||(new Date).toString(),a.ajax({url:"/ConPA/getOptimalPortfolio",type:"POST",data:{prods:g,referenceDate:h,targetReturn:undefined,lows:i,highs:j},success:function(k){if(k.message){a.publish("error.message.conpa",["Optimization error",k.message]);return}a.publish("crm.portfolio.conpa",[g,k.optim.solution,h,k.optim.pm,k.optim.ps,k.perf,j,i]),k.perf.length?(e(c,g,k.optim.solution),f(d,k.perf)):e(b,g,k.optim.solution)}})}function h(){b.empty(),c.empty(),d.empty()}function i(a,b,c){g(b,c)}"use strict";var b=a("#basket-pie-chart"),c=a("#basket-pie-ytd-chart"),d=a("#basket-performance-ytd-chart");a.subscribe("clear.portfolio.conpa",h),a.subscribe("optimize.portfolio.conpa",i)}(jQuery),function(a){function g(b){a.ajax({url:"/ConPA/getKeyStatistics",type:"POST",data:{symbol:b},success:function(a){var g,h,i;if(!a.length)return;g=a.length/2,h=a,i=h.splice(0,g),d.html("Asset Stats for "+b),e.html(c({fields:i})),f.html(c({fields:h}))}})}function h(a,b){g(b)}"use strict";var b='<dl class="dl-horizontal"><% _.each(fields, function (field) { %><dt title="<%= field.inputParams.label %>"><%= field.inputParams.label %></dt><dd><%= field.inputParams.value %></dd><% }) %></dl>',c=_.template(b),d=a("#asset-stats-name"),e=a("#asset-stats-list1"),f=a("#asset-stats-list2");a.subscribe("stats.asset.conpa",h)}(jQuery),function(a){function e(){d.html(c({assets:a.sync("conpa-assets")}))}function f(b){var c=a(b.target).closest("li").data("id"),d=a.sync("conpa-assets");a.each(d,function(b,f){if(f.id===c)return d.splice(b,1),a.sync("conpa-assets",d),e(),a.publish("render.app.conpa"),!1})}"use strict";var b='<% _.each(assets, function (asset, key, list) { %><li data-id="<%= asset.id %>"><div class="well"><div><%= asset.symbol %></div><div class="destroy"></div></div></li><% }) %>',c=_.template(b),d=a("#asset-list");d.on("click",".destroy",f),a.subscribe("render.assetlist.conpa",e)}(jQuery);var YAHOO={};YAHOO.Finance={},YAHOO.Finance.SymbolSuggest={},function(a){"use strict";var b={};a("input").typeahead({items:10,source:function(a,c){jQuery.ajax({type:"GET",dataType:"jsonp",jsonp:"callback",jsonpCallback:"YAHOO.Finance.SymbolSuggest.ssCallback",data:{query:a},cache:!0,url:"http://autoc.finance.yahoo.com/autoc"}),YAHOO.Finance.SymbolSuggest.ssCallback=function(a){var d;d=jQuery.map(a.ResultSet.Result,function(a){var c={symbol:a.symbol,name:a.name,type:a.type,exchDisp:a.exchDisp},d=c.symbol+" "+c.name+" ("+c.type+" - "+c.exchDisp+")";return b[d]=c,d}),c(d)}},updater:function(a){return b[a].symbol}})}(jQuery),function(a){"use strict",a.conpa={utils:{rfc4122v4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a==="x"?b:b&3|8;return c.toString(16)})}},helpers:{percentageFormatter:function(a){return(a*100).toFixed(2)+"%"},hyphenFormatter:function(a){return a.substr(0,5)+"..."+a.substr(a.length-5,5)}},dates:{today:function(){return new Date},yearToDate:function(){return new Date(a.conpa.dates.today()-31536e6)}}}}(jQuery),function(a){"use strict";var b={init:function(){a("#new-asset").on("selectitem",this.create),a.publish("render.dashboard.conpa"),a.publish("render.app.conpa")},create:function(b){var c=a.sync("conpa-assets"),d=a(b.target),e=a.trim(d.val());c.push({id:a.conpa.utils.rfc4122v4(),symbol:e}),d.val(""),a.sync("conpa-assets",c),a.publish("render.app.conpa")},render:function(){var b=a.sync("conpa-assets"),c=_.last(b);a.publish("clear.portfolio.conpa"),a.publish("clear.message.conpa"),a.publish("render.assetlist.conpa"),b.length&&a.publish("stats.asset.conpa",[c.symbol]),a.publish("optimize.portfolio.conpa",[b,a.conpa.dates.today().toString()]),a.publish("optimize.portfolio.conpa",[b,a.conpa.dates.yearToDate().toString()])}};a.subscribe("render.app.conpa",b.render),b.init()}(jQuery);